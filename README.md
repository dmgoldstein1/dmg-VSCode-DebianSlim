# VS Code Server Debian Container

<!-- Generated by Copilot (GPT-4), 2025-08-28 -->
<!-- This README documents the VS Code Server Docker container build script and its features. -->
<!-- It provides comprehensive usage instructions for secure, containerized VS Code development environments. -->

A secure, containerized VS Code Server environment built on Debian Slim with automated vulnerability analysis and GitHub tunnel support.

## Features

- **Secure Base Image**: Built on Debian Stable Slim with minimal attack surface
- **Automated Security Scanning**: Docker Scout vulnerability analysis with intelligent caching
- **GitHub Tunnel Integration**: Seamless remote access via GitHub tunnels
- **Port Conflict Resolution**: Automatic port detection and assignment
- **Intelligent Redundancy Reduction**: Skips unnecessary rebuilds and analysis
- **Flexible Logging**: Quiet by default, verbose when needed
- **Autonomous Copilot Support**: Optional auto-approval for terminal commands

## Quick Start

### Basic Usage
```bash
# Build and launch with auto-generated tunnel name
./build_vscode_docker_debian_slim_secure.sh

# Build and launch with custom tunnel name
./build_vscode_docker_debian_slim_secure.sh my_dev_tunnel
```

### Advanced Usage
```bash
# Enable verbose logging for debugging
./build_vscode_docker_debian_slim_secure.sh my_tunnel --logging

# Force security analysis even if cached
./build_vscode_docker_debian_slim_secure.sh my_tunnel --force-analysis

# Enable autonomous Copilot terminal commands
./build_vscode_docker_debian_slim_secure.sh my_tunnel --copilot-is-autonomous

# Combine multiple flags
./build_vscode_docker_debian_slim_secure.sh my_tunnel --logging --copilot-is-autonomous
```

## Command Line Options

| Flag | Description |
|------|-------------|
| `[TunnelName]` | Optional custom tunnel name (lowercase letters, numbers, underscores only) |
| `--logging` | Enable verbose output for debugging and detailed progress information |
| `--force-analysis` | Force Docker Scout analysis even if cached results exist |
| `--copilot-is-autonomous` | Configure VS Code to auto-approve terminal commands for GitHub Copilot |

## Tunnel Name Validation

Tunnel names must follow these rules:
- Only lowercase letters (a-z)
- Numbers (0-9) 
- Underscores (_)
- No capital letters, spaces, or special characters

**Valid Examples**: `my_tunnel`, `dev_env_2024`, `project_alpha`
**Invalid Examples**: `My-Tunnel`, `dev env`, `project@home`

## Security Features

### Automated Vulnerability Scanning
The script automatically runs Docker Scout analysis to identify:
- Critical, High, Medium, and Low severity vulnerabilities
- Package-specific security issues
- Recommended updates and fixes

### Intelligent Caching
- Skips redundant image builds when dependencies haven't changed
- Caches vulnerability analysis results by image tag
- Reduces build time for subsequent runs

### Non-Root Container Execution
- All VS Code processes run as `devuser` (non-root)
- Sudo access available when needed for development tasks

## Port Management

The script automatically handles port conflicts:
- Starts checking at port 8080
- Auto-increments to find available ports (8081, 8082, etc.)
- Supports multiple concurrent containers

## GitHub Tunnel Setup

1. Run the script with your desired tunnel name
2. Copy the authentication code from the output
3. Visit the provided GitHub device login URL
4. Enter the code to authorize the tunnel
5. Access your environment via `https://vscode.dev/tunnel/[tunnel-name]`

## Autonomous Copilot Mode

When using `--copilot-is-autonomous`, the container is configured to automatically approve terminal commands suggested by GitHub Copilot. This creates a VS Code server settings file at `/home/devuser/.vscode-server/data/Machine/settings.json` with:

```json
{
    "chat.tools.terminal.autoApprove": {
        "/*/": true
    }
}
```

**⚠️ Security Warning**: Only use autonomous mode in trusted development environments. This setting allows Copilot to execute terminal commands without manual approval.

## File Structure

```
├── Dockerfile                              # Container definition with security patches
├── build_vscode_docker_debian_slim_secure.sh  # Main build and launch script
└── README.md                               # This documentation
```

## Logging and Debugging

### Default (Quiet) Mode
Shows only essential information:
- Container status
- Vulnerability summary
- Tunnel authentication details

### Verbose Mode (`--logging`)
Provides detailed information including:
- Build process steps
- Security scan details
- Container operation logs
- Debug information for troubleshooting

## Dependencies

### System Requirements
- Docker (with Docker Scout enabled)
- `lsof` command for port detection
- `awk`/`gawk` for log processing

### Container Includes
- VS Code Server (latest stable)
- GitHub CLI
- Git
- Essential development tools
- Node.js and npm (for security patching)

## Troubleshooting

### Common Issues

**Port Already in Use**
- The script automatically finds available ports
- Check `docker ps` for existing containers

**Tunnel Authentication Fails**
- Ensure you're logged into GitHub
- Copy the exact authentication code provided
- Use the specific device login URL shown

**Container Won't Start**
- Check Docker daemon is running
- Verify image built successfully
- Use `--logging` flag for detailed error information

### Getting Container Logs
```bash
# View container output
docker logs [container-name]

# Follow live logs
docker logs -f [container-name]
```

### Accessing Container Shell
```bash
# Get interactive shell
docker exec -it [container-name] bash
```

## Performance Optimization

- **Image Caching**: Containers reuse existing images when possible
- **Analysis Caching**: Security scans cached by image tag
- **Background Execution**: Containers run in detached mode
- **Minimal Base**: Debian Slim reduces image size and attack surface

## Security Best Practices

1. **Regular Updates**: Rebuild containers periodically for security patches
2. **Tunnel Management**: Use descriptive tunnel names for identification
3. **Access Control**: Monitor tunnel access via GitHub settings
4. **Resource Limits**: Consider Docker resource constraints for production use
5. **Autonomous Mode**: Only enable Copilot autonomy in trusted environments

## Contributing

When modifying this script:
1. Maintain backward compatibility
2. Update this README for new features
3. Test with both `--logging` and quiet modes
4. Ensure security scanning continues to work
5. Follow the existing code style and comments

## License

This project follows standard Docker and VS Code licensing terms. See individual component licenses for details.
